input: packages
output: .github/workflows/autogenerated-builder.yml

runs-on: ubuntu-latest
timeout: 360

overrides:
    #####
    # ALREADY IN COMMUNITY-TESTING

    comgr:
        build: false

    composable-kernel:
        build: false

    hip-runtime-amd:
        build: false

    hipcub:
        build: false

    hipfft:
        build: false

    hipsparse:
        build: false

    hsa-rocr:
        build: false

    hsakmt-roct:
        build: false

    python-cppheaderparser:
        build: false

    rocalution:
        build: false

    rocblas:
        build: false

    rocfft:
        build: false

    rocm-clang-ocl:
        build: false

    rocm-cmake:
        build: false

    rocm-device-libs:
        build: false

    rocm-llvm:
        build: false

    rocm-opencl-runtime:
        build: false

    rocm-smi-lib:
        build: false

    rocminfo:
        build: false

    rocprim:
        build: false

    rocrand:
        build: false

    rocsparse:
        build: false

    rocthrust:
        build: false

    #####
    # SELF-HOSTED

    hipmagma:
        runs-on: self-hosted
        timeout: 1440

    linux-zen-custom:
        pre-build-commands:
            - su user --command "gpg --import keys/pgp/ABAF11C65A2970B130ABE3C479BE3E4300411886"
            - su user --command "gpg --import keys/pgp/647F28654894E3BD457199BE38DBBDC86092693E"
            - su user --command "gpg --import keys/pgp/A2FF3A36AAA56654109064AB19802F8B0D70FC30"
            - su user --command "gpg --import keys/pgp/C5ADB4F3FEBBCE27A3E54D7D9AE4078033F8024D"

    python-pytorch-rocm:
        runs-on: self-hosted
        timeout: 1440

        pre-build-commands:
            - sed '/prepare()/a\  git config --global protocol.file.allow always' -i PKGBUILD
            - sed '/git submodule update/a\  sed "1i#include <mutex>" -i third_party/kineto/libkineto/src/RoctracerActivityApi.h' -i PKGBUILD
            - sed 's/79360/87773/g' -i PKGBUILD

    python-torchvision-rocm:
        runs-on: self-hosted
        timeout: 1440
        build: false

        pre-build-commands:
            - echo 'export ROCM_HOME=/opt/rocm' >> PKGBUILD

    rccl:
        runs-on: self-hosted
        timeout: 1440

    rocsolver:
        runs-on: self-hosted
        timeout: 1440